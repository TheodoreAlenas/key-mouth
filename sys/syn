#!/bin/sh
# stands for `synchronize.' Doesn't deploy as-is.

main() {
    case "$*" in
        ('') package_for_sending && send_all && echo "done" ;;
        (p) package_for_sending ;;
        (*) sed '/^# end of help/q' >&2 && exit 1 ;;
    esac
}
# end of help

set -e
cd ..
d=git-ignores/deploy.gitig

package_for_sending() {
    mkdir -p $d
    mkdir -p $d/python $d/static $d/sys
    (cd python && git ls-files) \
        | rsync --archive --delete --files-from=- python $d/python
    rsync --archive --delete git-ignores/front-static-serve.gitig/ $d/static/
    rsync --archive --delete server-scripts/ $d/sys/
}
send_all() {
    . sys/secrets.gitig.sh
    echo "rsync to remote..."
    rsync --archive --compress --delete $d/ "$secret_upload"/
}

main "$@"
